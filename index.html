<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Graph Renderer</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: sans-serif;
    }
    #app {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
    }
    .level-container {
      display: flex;
      box-sizing: border-box;
      align-items: stretch;
    }
    .box {
      flex: 1 1 auto;
      min-width: 50px;
      min-height: 50px;
      margin: 10px;
      padding: 5px;
      border: 1px solid #333;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s, font-size 0.2s;
      box-sizing: border-box;
      font-size: 1rem;
    }
    .box:hover {
      background: rgba(0,0,0,0.05);
    }
    .box.no-hover:hover {
      background: none;
    }
    .box.selected-parent {
      border: 2px solid #007BFF;
    }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    const DummyData1 = {
      nodes: [
        { id: "Nav_1", fields: { label: "Nav_1", listDirection: "H", recursiveChildren: false, alwaysRender: false } },
        { id: "Nav_2", fields: { label: "Nav_2", listDirection: "H", recursiveChildren: false, alwaysRender: false } },
        { id: "Nav_3", fields: { label: "Nav_3", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Nav_4", fields: { label: "Nav_4", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Nav_5", fields: { label: "Nav_5", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Nav_6", fields: { label: "Nav_6", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Nav_7", fields: { label: "Nav_7", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Nav_8", fields: { label: "Nav_8", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Nav_9", fields: { label: "Nav_9", listDirection: "H", recursiveChildren: false, alwaysRender: true } },

        { id: "Kanban_1", fields: { label: "Kanban_1", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Kanban_2", fields: { label: "Kanban_2", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Kanban_3", fields: { label: "Kanban_3", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Kanban_4", fields: { label: "Kanban_4", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Kanban_5", fields: { label: "Kanban_5", listDirection: "V", recursiveChildren: false, alwaysRender: false } },

        { id: "Tender_1", fields: { label: "Tender_1", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_2", fields: { label: "Tender_2", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_3", fields: { label: "Tender_3", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_4", fields: { label: "Tender_4", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_5", fields: { label: "Tender_5", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_6", fields: { label: "Tender_6", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_7", fields: { label: "Tender_7", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_8", fields: { label: "Tender_8", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_9", fields: { label: "Tender_9", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_10", fields: { label: "Tender_10", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_11", fields: { label: "Tender_11", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_12", fields: { label: "Tender_12", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        // New children for Kanban_2
        { id: "Tender_13", fields: { label: "Tender_13", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_14", fields: { label: "Tender_14", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        // New children for Kanban_4
        { id: "Tender_15", fields: { label: "Tender_15", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_16", fields: { label: "Tender_16", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_17", fields: { label: "Tender_17", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Tender_18", fields: { label: "Tender_18", listDirection: "H", recursiveChildren: false, alwaysRender: true } },

        { id: "Not started", fields: { label: "Not started", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Authoring", fields: { label: "Authoring", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Review", fields: { label: "Review", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Submitted", fields: { label: "Submitted", listDirection: "V", recursiveChildren: false, alwaysRender: false } },
        { id: "Project ABC", fields: { label: "Project ABC", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Project DEF", fields: { label: "Project DEF", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Project GHI", fields: { label: "Project GHI", listDirection: "H", recursiveChildren: false, alwaysRender: true } },
        { id: "Project JKL", fields: { label: "Project JKL", listDirection: "H", recursiveChildren: false, alwaysRender: true } }
      ],
      edges: [
        { parent: "Nav_1", child: "Kanban_1" },
        { parent: "Nav_1", child: "Kanban_2" },
        { parent: "Nav_1", child: "Kanban_3" },
        { parent: "Nav_1", child: "Kanban_4" },
        { parent: "Nav_1", child: "Kanban_5" },
        { parent: "Kanban_1", child: "Tender_1" },
        { parent: "Kanban_1", child: "Tender_2" },
        { parent: "Kanban_1", child: "Tender_3" },
        { parent: "Kanban_1", child: "Tender_4" },
        { parent: "Kanban_1", child: "Tender_5" },
        { parent: "Kanban_1", child: "Tender_6" },
        { parent: "Kanban_1", child: "Tender_7" },
        { parent: "Kanban_1", child: "Tender_8" },
        { parent: "Kanban_1", child: "Tender_9" },
        { parent: "Kanban_1", child: "Tender_10" },
        { parent: "Kanban_1", child: "Tender_11" },
        { parent: "Kanban_1", child: "Tender_12" },
        { parent: "Kanban_2", child: "Tender_13" },
        { parent: "Kanban_2", child: "Tender_14" },
        { parent: "Kanban_4", child: "Tender_15" },
        { parent: "Kanban_4", child: "Tender_16" },
        { parent: "Kanban_4", child: "Tender_17" },
        { parent: "Kanban_4", child: "Tender_18" },
        { parent: "Nav_2", child: "Not started" },
        { parent: "Nav_2", child: "Authoring" },
        { parent: "Nav_2", child: "Review" },
        { parent: "Nav_2", child: "Submitted" },
        { parent: "Not started", child: "Project ABC" },
        { parent: "Authoring", child: "Project DEF" },
        { parent: "Authoring", child: "Project GHI" },
        { parent: "Authoring", child: "Project JKL" }
      ]
    };

    // Build lookup
    const nodesById = new Map();
    DummyData1.nodes.forEach(n => nodesById.set(n.id, { ...n, children: [], parents: [] }));
    DummyData1.edges.forEach(e => {
      const p = nodesById.get(e.parent);
      const c = nodesById.get(e.child);
      if (p && c) { p.children.push(c); c.parents.push(p); }
    });

    const rootNodes = Array.from(nodesById.values()).filter(n => n.parents.length === 0);
    let selectedNode = null;
    const app = document.getElementById('app');

    function renderAll() {
      app.innerHTML = '';
      const levels = [];

      if (selectedNode) {
        const ancestors = [];
        let cur = selectedNode;
        while (true) {
          ancestors.unshift(cur);
          if (cur.parents.length === 0) break;
          cur = cur.parents[0];
        }
        levels.push({ nodes: rootNodes, parent: null });
        for (let i = 1; i < ancestors.length; i++) {
          const parent = ancestors[i].parents[0] || null;
          const nodes = parent ? parent.children : rootNodes;
          levels.push({ nodes, parent });
        }
        levels.push({ nodes: selectedNode.children, parent: selectedNode });
      } else {
        levels.push({ nodes: rootNodes, parent: null });
      }

      const levelDivs = [];
      levels.forEach((lvlData, idx) => {
        let { nodes, parent } = lvlData;
        // filter out leaves when alwaysRender is false
        nodes = nodes.filter(n => n.children.length > 0 || n.fields.alwaysRender);
        const dir = parent?.fields.listDirection || 'H';
        const lvl = document.createElement('div');
        lvl.className = 'level-container';
        lvl.style.flexDirection = dir === 'H' ? 'row' : 'column';
        if (idx === levels.length - 1) {
          lvl.style.flex = '1 1 auto';
          lvl.style.alignSelf = 'stretch';
        } else {
          lvl.style.flex = '0 0 auto';
          lvl.style.alignSelf = dir === 'V' ? 'flex-start' : 'stretch';
        }
        lvl.style.overflowX = dir === 'H' ? 'auto' : 'hidden';
        lvl.style.overflowY = dir === 'V' ? 'auto' : 'hidden';

        nodes.forEach(node => {
          const box = document.createElement('div');
          box.className = 'box';
          box.dataset.nodeId = node.id;
          box.textContent = node.fields.label;
          if (node.children.length > 0) {
            box.addEventListener('click', () => { selectedNode = node; renderAll(); });
          } else {
            box.style.cursor = 'default';
            box.classList.add('no-hover');
          }
          lvl.appendChild(box);
        });

        levelDivs.push({ div: lvl, parent });
        app.appendChild(lvl);
      });

      levelDivs.forEach((lvlObj, idx) => {
        const { div, parent } = lvlObj;
        if (parent && idx > 0) {
          const prevDiv = levelDivs[idx - 1].div;
          const selBox = prevDiv.querySelector(`[data-node-id="${parent.id}"]`);
          if (selBox) selBox.classList.add('selected-parent');
        }
      });
    }

    window.addEventListener('DOMContentLoaded', () => renderAll());
  </script>
</body>
</html>

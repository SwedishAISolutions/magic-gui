<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dynamic Container Renderer</title>
  <style>
    html, body { margin: 0; padding: 0; height: 100%; }
    body { display: flex; font-family: Arial, sans-serif; }
    #app { display: flex; flex-direction: row; width: 100vw; height: 100vh; overflow: hidden; }

    /* Level containers */
    .level { display: flex; overflow: auto; }
    .level.vertical { flex-direction: column; }
    .level.horizontal { flex-direction: row; }

    /* Ancestor levels: shrink only in main axis, stretch cross-axis */
    .level.vertical.ancestor {
      flex: 0 1 auto;  /* shrink width only */
      height: 100%;    /* stretch full height */
    }
    .level.horizontal.ancestor {
      flex: 0 1 auto;  /* shrink height only */
      width: 100%;     /* stretch full width */
    }

    /* Bottom level: fill remaining space equally */
    .level.bottom.vertical,
    .level.bottom.horizontal {
      flex: 1;
      display: flex;
      justify-content: space-evenly;
      align-items: stretch;
    }
    .level.bottom .container {
      flex: 1;
      margin: 4px;
    }

    /* Container styles */
    .container {
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 10px;
      margin: 4px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: flex-start;
      background: #e0f0ff;
      cursor: pointer;
      white-space: nowrap;
    }
    .level.horizontal .container { background: #e0ffe0; }
    .container.selected { border: 3px solid #000; }
    .container.leaf { pointer-events: none; opacity: 0.6; }
    .leaf-indicator { margin-top: 4px; font-style: italic; color: #666; }

    h2 { margin: 0; font-size: 1em; }
    h4 { margin: 4px 0 0; font-size: 0.9em; }
  </style>
</head>
<body>
  <div id="app"></div>
  <script>
    const data = [
      { title: 'Container A', subtitle: 'Level 1', layout: 'vertical' },
      { title: 'Container B', subtitle: 'Level 1', layout: 'vertical' },
      { title: 'Container C', subtitle: 'Level 1', layout: 'vertical' }
    ];
    const EVENT = 'pointerup';
    const app = document.getElementById('app');
    let path = [];

    function generateChildren(parent) {
      const count = Math.floor(Math.random() * 4);
      const depth = (parent._depth || 0) + 1;
      return Array.from({ length: count }, (_, i) => ({
        title: `${parent.title}.${i+1}`,
        subtitle: `Level ${depth+1}`,
        layout: 'vertical',
        _depth: depth
      }));
    }

    function createContainer(item) {
      const div = document.createElement('div');
      div.className = 'container';
      if (item._selected) div.classList.add('selected');
      if (!item.children) item.children = generateChildren(item);
      if (item.children.length === 0) div.classList.add('leaf');
      const h2 = document.createElement('h2'); h2.textContent = item.title; div.appendChild(h2);
      const h4 = document.createElement('h4'); h4.textContent = item.subtitle; div.appendChild(h4);
      if (item.children.length === 0) {
        const leaf = document.createElement('div'); leaf.className = 'leaf-indicator'; leaf.textContent = 'Leaf'; div.appendChild(leaf);
      } else {
        div.addEventListener(EVENT, () => {
          const depth = item._depth;
          path = path.slice(0, depth);
          path.push(item);
          function clearAll(arr) { arr.forEach(x => { delete x._selected; if (x.children) clearAll(x.children); }); }
          clearAll(data);
          path.forEach(p => p._selected = true);
          render();
        });
      }
      return div;
    }

    function render() {
      app.innerHTML = '';
      const levels = [data];
      path.forEach(node => levels.push(node.children));
      levels.forEach((items, idx) => {
        const isAncestor = idx < levels.length - 1;
        const isBottom = !isAncestor;
        // Determine layout: root uses data[0].layout, others use parent layout
        const layout = idx === 0 ? data[0].layout : path[idx - 1].layout;
        const lvl = document.createElement('div');
        lvl.classList.add('level', layout);
        if (isAncestor) lvl.classList.add('ancestor'); else lvl.classList.add('bottom');
        items.forEach(item => lvl.appendChild(createContainer(item)));
        app.appendChild(lvl);
      });
    }

    render();
  </script>
</body>
</html>
